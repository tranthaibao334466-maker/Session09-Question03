CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    category_id INT,
    price NUMERIC,
    stock_quantity INT
);

-- Chèn 200 dữ liệu vào bảng 
INSERT INTO products (category_id, price, stock_quantity)
VALUES 
(1, 10.00, 100),
(2, 20.00, 200),
(3, 30.00, 300),
(4, 40.00, 400),
(5, 50.00, 500),
(1, 15.00, 150),
(2, 25.00, 250),
(3, 35.00, 350),
(4, 45.00, 450),
(5, 55.00, 550),
(1, 12.00, 120),
(2, 22.00, 220),
(3, 32.00, 320),
(4, 42.00, 420),
(5, 52.00, 520),
(1, 18.00, 180),
(2, 28.00, 280),
(3, 38.00, 380),
(4, 48.00, 480),
(5, 58.00, 580),
(1, 14.00, 140),
(2, 24.00, 240),
(3, 34.00, 340),
(4, 44.00, 440),
(5, 54.00, 540),
(1, 16.00, 160),
(2, 26.00, 260),
(3, 36.00, 360),
(4, 46.00, 460),
(5, 56.00, 560),
(1, 11.00, 110),
(2, 21.00, 210),
(3, 31.00, 310),
(4, 41.00, 410),
(5, 51.00, 510),
(1, 19.00, 190),
(2, 29.00, 290),
(3, 39.00, 390),
(4, 49.00, 490),
(5, 59.00, 590),
(6, 60.00, 600),
(7, 70.00, 700),
(8, 80.00, 800),
(9, 90.00, 900),
(10, 100.00, 1000),
(6, 65.00, 650),
(7, 75.00, 750),
(8, 85.00, 850),
(9, 95.00, 950),
(10, 105.00, 1050),
(6, 62.00, 620),
(7, 72.00, 720),
(8, 82.00, 820),
(9, 92.00, 920),
(10, 102.00, 1020),
(6, 68.00, 680),
(7, 78.00, 780),
(8, 88.00, 880),
(9, 98.00, 980),
(10, 108.00, 1080),
(6, 64.00, 640),
(7, 74.00, 740),
(8, 84.00, 840),
(9, 94.00, 940),
(10, 104.00, 1040),
(6, 66.00, 660),
(7, 76.00, 760),
(8, 86.00, 860),
(9, 96.00, 960),
(10, 106.00, 1060),
(6, 61.00, 610),
(7, 71.00, 710),
(8, 81.00, 810),
(9, 91.00, 910),
(10, 101.00, 1010),
(6, 69.00, 690),
(7, 79.00, 790),
(8, 89.00, 890),
(9, 99.00, 990),
(10, 109.00, 1090),
(11, 110.00, 1100),
(12, 120.00, 1200),
(13, 130.00, 1300),
(14, 140.00, 1400),
(15, 150.00, 1500),
(11, 115.00, 1150),
(12, 125.00, 1250),
(13, 135.00, 1350),
(14, 145.00, 1450),
(15, 155.00, 1550),
(11, 112.00, 1120),
(12, 122.00, 1220),
(13, 132.00, 1320),
(14, 142.00, 1420),
(15, 152.00, 1520),
(11, 118.00, 1180),
(12, 128.00, 1280),
(13, 138.00, 1380),
(14, 148.00, 1480),
(15, 158.00, 1580),
(11, 114.00, 1140),
(12, 124.00, 1240),
(13, 134.00, 1340),
(14, 144.00, 1440),
(15, 154.00, 1540),
(11, 116.00, 1160),
(12, 126.00, 1260),
(13, 136.00, 1360),
(14, 146.00, 1460),
(15, 156.00, 1560),
(11, 111.00, 1110),
(12, 121.00, 1210),
(13, 131.00, 1310),
(14, 141.00, 1410),
(15, 151.00, 1510),
(11, 119.00, 1190),
(12, 129.00, 1290),
(13, 139.00, 1390),
(14, 149.00, 1490),
(15, 159.00, 1590);

-- Về Clustered Index 
/* Clustered Index trong Postgres là một loại chỉ mục  
   mà dữ liệu trong bảng được sắp xếp vật lí và lưu trữ theo thứ tự của chỉ mục đó. 
   Nó giúp cải thiện hiệu suất truy vấn khoảng khi truy cập dữ liệu theo thứ tự của chỉ mục.
   Lí do mà Postgres không tự động tạo Clustered Index khi tạo chỉ mục B-Tree là vì:
   - Tính linh hoạt: Người dùng có thể chọn cột nào sẽ được sử dụng
   - Hiệu suất: Không phải tất cả các truy vấn đều hưởng lợi từ việc sắp xếp vật lí dữ liệu do khi INSERT/UPDATE sẽ tốn thời gian hơn.
   ( Đây là những điều mà các hệ quản trị cơ sở dữ liệu khác như SQL Server hay MySQL làm khác đi khi tự động tạo Clustered Index trên khóa chính ). 
          
Lưu ý: Một bảng chỉ có thể có một Clustered Index 
       Chỉ tạo được Clustered Index trên các cột có chỉ mục B-Tree ( và thông thường thì khóa chính là cột có chỉ mục B-Tree thường được sử dụng để tạo Clustered Index).
*/

CREATE INDEX idx_category_id ON products(category_id);
CLUSTER products USING idx_category_id;

CREATE INDEX idx_price ON products(price);

EXPLAIN ANALYZE SELECT * FROM products WHERE category_id = 5 ORDER BY price;

